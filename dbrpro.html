<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALEX PRO v11 - HD Financial Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        body { -webkit-font-smoothing: antialiased; }
        #masterWrap { min-height: fit-content; background-color: #020617; }
        .table-row:nth-child(even) { background-color: rgba(30, 41, 59, 0.4); }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 antialiased pb-40">

<div id="masterWrap" class="max-w-md mx-auto p-5 lg:max-w-4xl">
    <header class="mb-6">
        <h1 class="text-3xl font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-amber-400">ALEX PRO v11</h1>
        <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Full Financial Disclosure Engine</p>
    </header>

    <div class="space-y-4">
        <div class="bg-slate-900 p-5 rounded-3xl border border-slate-800">
            <input id="recordName" type="text" placeholder="CUSTOMER NAME" class="w-full bg-slate-800 border border-slate-700 p-3 rounded-2xl text-amber-400 font-bold outline-none mb-4 uppercase">
            
            <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-500 uppercase">Start Date</label>
                    <input id="startDate" type="date" class="w-full bg-white text-black p-2 rounded-xl font-bold text-sm" oninput="calculateAll()">
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-emerald-500 uppercase">Monthly Income</label>
                    <input id="income" type="number" placeholder="₹" class="w-full bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 p-2 rounded-xl font-bold text-sm" oninput="calculateAll()">
                </div>
            </div>

            <div class="space-y-3">
                <input id="principal" type="number" placeholder="Loan Amount (₹)" class="w-full bg-slate-800 border border-slate-700 p-4 rounded-2xl text-white font-bold text-lg" oninput="calculateAll()">
                <div class="grid grid-cols-2 gap-3">
                    <input id="rate" type="number" step="0.01" placeholder="Rate %" class="bg-slate-800 border border-slate-700 p-3 rounded-xl text-white font-bold" oninput="calculateAll()">
                    <div class="flex gap-1">
                        <input id="tenure" type="number" placeholder="Tenure" class="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl text-white font-bold" oninput="calculateAll()">
                        <select id="unit" class="bg-amber-600 text-black font-black px-2 rounded-xl text-[10px]" onchange="calculateAll()">
                            <option value="years">YRS</option>
                            <option value="months">MTH</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-slate-900 p-5 rounded-3xl border border-slate-800">
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-xs font-bold text-sky-400 uppercase tracking-widest">Existing EMIs</h2>
                <button onclick="addOb()" class="bg-sky-500 text-white px-4 py-1 rounded-full text-[10px] font-bold">+ ADD</button>
            </div>
            <div id="obList" class="space-y-2"></div>
        </div>

        <div id="results" class="hidden space-y-4">
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-emerald-500/10 border border-emerald-500/20 p-4 rounded-3xl text-center">
                    <p class="text-[10px] text-emerald-500 font-bold uppercase">Monthly EMI</p>
                    <p id="resEmi" class="text-xl font-black text-white">₹0</p>
                </div>
                <div class="bg-slate-800/50 p-4 rounded-3xl text-center border border-slate-700">
                    <p class="text-[10px] text-slate-400 font-bold uppercase">DBR Ratio</p>
                    <p id="resDbr" class="text-xl font-black text-white">0%</p>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div class="bg-amber-500/10 border border-amber-500/20 p-4 rounded-3xl text-center">
                    <p class="text-[10px] text-amber-500 font-bold uppercase">Total Interest</p>
                    <p id="resTotalInt" class="text-lg font-black text-white">₹0</p>
                </div>
                <div class="bg-sky-500/10 border border-sky-500/20 p-4 rounded-3xl text-center">
                    <p class="text-[10px] text-sky-400 font-bold uppercase">Total Repayment</p>
                    <p id="resTotalRepay" class="text-lg font-black text-white">₹0</p>
                </div>
            </div>

            <div class="bg-purple-600/10 border border-purple-500/20 p-5 rounded-3xl text-center">
                <p class="text-[10px] text-purple-400 font-bold uppercase tracking-[0.2em]">Max Loan Eligibility (60% DBR)</p>
                <p id="maxLoan" class="text-3xl font-black text-white mt-1">₹ 0</p>
            </div>

            <div class="bg-slate-900 rounded-3xl border border-slate-800 overflow-hidden shadow-2xl">
                <div class="bg-slate-800 p-3 text-[10px] font-black text-slate-300 text-center uppercase tracking-widest">Repayment Schedule (DD-MM-YYYY)</div>
                <table class="w-full text-left text-[11px]">
                    <thead class="bg-slate-900 text-slate-500 border-b border-slate-800">
                        <tr>
                            <th class="p-3">No.</th>
                            <th class="p-3">Date</th>
                            <th class="p-3">Prin</th>
                            <th class="p-3">Int</th>
                            <th class="p-3">Balance</th>
                        </tr>
                    </thead>
                    <tbody id="amortBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="fixed bottom-0 left-0 right-0 p-4 bg-slate-950/95 backdrop-blur-xl border-t border-slate-800 z-50">
    <div class="flex gap-2 max-w-lg mx-auto mb-3">
        <button onclick="saveRecord()" class="flex-1 bg-slate-800 text-white font-bold rounded-2xl py-4 text-xs uppercase">Save</button>
        <button id="shareBtn" onclick="exportHDImage()" class="flex-[2] bg-amber-500 text-black font-black rounded-2xl py-4 text-sm uppercase shadow-lg shadow-amber-500/20 transition-all active:scale-95">
            Share HD Image
        </button>
    </div>
    <div id="savedList" class="flex gap-2 overflow-x-auto no-scrollbar pb-2"></div>
</div>

<script>
    let obligations = [];
    let savedRecords = JSON.parse(localStorage.getItem('alex_v11_db') || '[]');
    const fmt = (v) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(v);

    const formatDate = (date) => {
        const d = new Date(date);
        const day = String(d.getDate()).padStart(2, '0');
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const year = d.getFullYear();
        return `${day}-${month}-${year}`;
    };

    function addOb() { obligations.push(0); renderObs(); }
    function renderObs() {
        const container = document.getElementById('obList');
        container.innerHTML = obligations.map((val, i) => `
            <div class="flex gap-2 items-center">
                <input type="number" value="${val || ''}" oninput="obligations[${i}]=parseFloat(this.value)||0; calculateAll();" 
                class="flex-1 bg-slate-800 border border-slate-700 p-3 rounded-xl text-sky-400 font-bold" placeholder="EMI Amount">
                <button onclick="obligations.splice(${i},1); renderObs(); calculateAll();" class="text-red-500 bg-red-500/10 p-3 rounded-xl">×</button>
            </div>
        `).join('');
    }

    function calculateAll() {
        const P = parseFloat(document.getElementById('principal').value);
        const annualR = parseFloat(document.getElementById('rate').value);
        const T = parseFloat(document.getElementById('tenure').value);
        const U = document.getElementById('unit').value;
        const income = parseFloat(document.getElementById('income').value) || 0;
        const sDateValue = document.getElementById('startDate').value;

        if (P && annualR && T && sDateValue) {
            const r = annualR / 12 / 100;
            const n = U === 'years' ? T * 12 : T;
            const emi = P * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
            
            document.getElementById('resEmi').textContent = fmt(emi);
            document.getElementById('results').classList.remove('hidden');

            let balance = P;
            let amortHtml = '';
            let totalInterest = 0;
            let currentDay = new Date(sDateValue);

            for (let i = 1; i <= n; i++) {
                let mInt = balance * r;
                let mPrin = emi - mInt;
                balance -= mPrin;
                totalInterest += mInt;
                
                amortHtml += `<tr class="table-row border-t border-slate-800/30">
                    <td class="p-3 text-slate-500">${i}</td>
                    <td class="p-3 text-amber-400 font-mono text-[10px]">${formatDate(currentDay)}</td>
                    <td class="p-3 text-emerald-500 font-bold">${fmt(mPrin)}</td>
                    <td class="p-3 text-red-400 font-bold">${fmt(mInt)}</td>
                    <td class="p-3 font-bold text-slate-200">${fmt(Math.max(0, balance))}</td>
                </tr>`;
                currentDay.setMonth(currentDay.getMonth() + 1);
            }
            
            // Populate New Summary Fields
            document.getElementById('resTotalInt').textContent = fmt(totalInterest);
            document.getElementById('resTotalRepay').textContent = fmt(P + totalInterest);
            document.getElementById('amortBody').innerHTML = amortHtml;

            const totalObs = obligations.reduce((a,b) => a+b, 0);
            const dbr = income > 0 ? ((totalObs + emi) / income) * 100 : 0;
            const dbrEl = document.getElementById('resDbr');
            dbrEl.textContent = dbr.toFixed(1) + '%';
            dbrEl.className = `text-xl font-black ${dbr > 60 ? 'text-red-500' : 'text-white'}`;

            const maxBudget = (income * 0.60) - totalObs;
            let maxElig = maxBudget > 0 ? maxBudget / ( (r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1) ) : 0;
            document.getElementById('maxLoan').textContent = fmt(Math.max(0, maxElig));
        }
    }

    function saveRecord() {
        const name = document.getElementById('recordName').value;
        if(!name) return alert("Enter Name");
        const data = { id: Date.now(), name, principal: document.getElementById('principal').value, rate: document.getElementById('rate').value, tenure: document.getElementById('tenure').value, unit: document.getElementById('unit').value, income: document.getElementById('income').value, sDate: document.getElementById('startDate').value, obs: [...obligations] };
        const idx = savedRecords.findIndex(r => r.name === name);
        if(idx > -1) savedRecords[idx] = data; else savedRecords.unshift(data);
        localStorage.setItem('alex_v11_db', JSON.stringify(savedRecords));
        renderSaved();
    }

    function renderSaved() {
        const list = document.getElementById('savedList');
        list.innerHTML = savedRecords.map(r => `
            <div class="flex items-center bg-slate-800 rounded-2xl px-4 py-2 whitespace-nowrap gap-3 border border-slate-700 shadow-sm">
                <span onclick="loadRecord(${r.id})" class="text-[10px] font-black cursor-pointer uppercase tracking-wider">${r.name}</span>
                <button onclick="deleteRecord(${r.id})" class="text-red-500 font-bold text-lg">×</button>
            </div>
        `).join('');
    }

    function loadRecord(id) {
        const r = savedRecords.find(x => x.id === id);
        document.getElementById('recordName').value = r.name;
        document.getElementById('principal').value = r.principal;
        document.getElementById('rate').value = r.rate;
        document.getElementById('tenure').value = r.tenure;
        document.getElementById('unit').value = r.unit;
        document.getElementById('income').value = r.income;
        document.getElementById('startDate').value = r.sDate;
        obligations = r.obs; renderObs(); calculateAll();
    }

    function deleteRecord(id) {
        savedRecords = savedRecords.filter(x => x.id !== id);
        localStorage.setItem('alex_v11_db', JSON.stringify(savedRecords));
        renderSaved();
    }

    async function exportHDImage() {
        const btn = document.getElementById('shareBtn');
        const area = document.getElementById('masterWrap');
        const name = (document.getElementById('recordName').value || "Loan_Proposal").replace(/\s+/g, '_');
        
        btn.innerText = "CAPTURING HD SUMMARY...";
        btn.disabled = true;

        window.scrollTo(0,0);
        await new Promise(r => setTimeout(r, 1200));

        html2canvas(area, {
            backgroundColor: '#020617',
            scale: 3, 
            useCORS: true,
            height: area.scrollHeight,
            windowHeight: area.scrollHeight
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = `${name}.jpg`;
            link.href = canvas.toDataURL("image/jpeg", 0.95);
            link.click();
            
            btn.innerText = "SHARE HD IMAGE";
            btn.disabled = false;
        });
    }

    renderSaved();
</script>
</body>
</html>